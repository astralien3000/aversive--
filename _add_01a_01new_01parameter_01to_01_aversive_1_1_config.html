<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Aversive++: Add a new parameter to Aversive::Config</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Aversive++
   </div>
   <div id="projectbrief">A library for microcontrollers programming</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Add a new parameter to <a class="el" href="class_aversive_1_1_config.html" title="Class holding the configuration of Aversive++. ">Aversive::Config</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section warning"><dt>Warning</dt><dd>For Aversive++ developer only. This is not meant to be used by Aversive++ user.</dd></dl>
<p>To add a new parameter to <a class="el" href="class_aversive_1_1_config.html" title="Class holding the configuration of Aversive++. ">Aversive::Config</a>, you just need to follow a few steps. In this tutorial, the parameter we want to add is named "dummy".</p>
<p>First, open <a class="el" href="config_8hpp.html">include/common/config.hpp</a> and add a "static const void*" private attribute to the class. The name of the attribute must be prefixed by "__PARAM_". <br/>
So in our case, we would add the following code in the private scope of the class <a class="el" href="class_aversive_1_1_config.html" title="Class holding the configuration of Aversive++. ">Aversive::Config</a>: </p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">void</span>* __PARAM_DUMMY;</div>
</div><!-- fragment --><p>Now we have a symbol to hold our parameter, we need a way to retrieve its value. Therefore, add a "static inline" method in the public scope of the class. This method must be called the same as our parameter, in our case, "dummy". This method can optionally take parameters and can return anything. Nevertheless, in most of the cases (if not all), it should not take any parameter and just return an integral value. <br/>
So in our case, we would add the following code in the public scope of the class <a class="el" href="class_aversive_1_1_config.html" title="Class holding the configuration of Aversive++. ">Aversive::Config</a>: </p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> s8 dummy(<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="keywordflow">return</span> (s8) ((intptr_t) &amp;__PARAM_DUMMY);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The interim cast to intptr_t is there to avoid a compile-time warning. Indeed, it is an integral type with the same size as an address on the targeted platform. Its unsigned counterpart also exists and is just prefixed with an "u".</dd>
<dd>
Remember to document both the attribute and the method.</dd></dl>
<p>We can now close this file and execute the following command at the root of Aversive++: </p>
<div class="fragment"><div class="line">make config_symbols | grep DUMMY</div>
</div><!-- fragment --><p> This command outputs the name of the symbol that will hold the value of the parameter. Copy it somewhere, we will need it soon.</p>
<p>Now open the file doc/example/new_project/Makefile which is the blank Makefile the users use to create a new project using Aversive++.</p>
<p>Look for the section "Aversive++ Configuration" in this file. This where we add the parameter the users will be able to set up as they will. The variable must be prefixed by "PARAM_". And we need to give it a value. Thus it has a default value and the users do not need to bother to set it up if they are in the most average case. <br/>
So in our case, we would add the line: </p>
<div class="fragment"><div class="line">PARAM_DUMMY=42</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Document what is the purpose of the parameter we are adding with a comment on the line above.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>As you may remember, we casted the address of the symbol into intptr_t in our method. Because that is all we can set through this method, we actually let the user set the address of our symbol. Therefore, the range of value is limited to the length of the addresses on the targeted platform for our parameter. Thus, we have to consider choosing a right scale for the parameter value. For example, if we want a parameter to hold the frequency of an <a class="el" href="class_a_v_r.html" title="Class providing meta-data for AVR microcontrollers. ">AVR</a> chip, we should not ask the user to put it in Hz because 16 Mhz will not fit in 16 bits. We should ask the user to put it in KHz or MHz instead.</dd></dl>
<p>Now that we gave a way to the user to set our new parameter up, we still need to pass it to the linker. Still in the same file, look for the subsection Config symboles under Automatic Configuration. Here we need to add a variable that will hold the name of our symbol and its value given by the user. Thys variable must be called after the name of our parameter and be suffixed by "_SYM". <br/>
So in our case, we would add the line: </p>
<div class="fragment"><div class="line">DUMMY_SYM=_ZN8Aversive6Config13__PARAM_DUMMYE=$(PARAM_DUMMY)</div>
</div><!-- fragment --><p>Finally, at the end of the section should be a "SYMBOL_LIST" variable. We just add our symbol variable to the list. <br/>
So in our case, the line would look like (... being the symbols already there): </p>
<div class="fragment"><div class="line">SYMBOL_LIST=... $(DUMMY_SYM)</div>
</div><!-- fragment --><p>And that is all. We successfully added a new parameter to Aversive++. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Nov 2 2014 13:00:14 for Aversive++ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
